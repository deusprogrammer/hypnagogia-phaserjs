/*! For license information please see main.4b02c0d0e3bf4d824a37.bundle.js.LICENSE.txt */
(()=>{var e,t={669:(e,t,s)=>{"use strict";s(260);class i extends Phaser.Scene{constructor(){super({key:"ErrorScene"})}init({errorMessage:e}){this.errorMessage=e}create(){this.add.text(.5*this.game.scale.width,.5*this.game.scale.height,this.errorMessage,{fontSize:"30pt",stroke:"#000",strokeThickness:5}).setOrigin(.5,.5)}update(){}}const a=48,o="down",r="left",l="right";class n extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,i),e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0),this.setOrigin(0,0),this.setBounce(0,0),this.body.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0},this.direction=r,this.block={x:0,y:0},this.center={x:0,y:0},this.fixed={x:t,y:s}}}class h extends n{constructor(e,t,s,i){super(e,t,s,i),this.setInteractive()}update(){this.fixed={x:this.x,y:this.y},this.center.x=this.x+24,this.center.y=this.y+24,this.block.x=Math.floor(this.center.x/a),this.block.y=Math.floor(this.center.y/a),this.depth=this.block.y,this.adjustForCollisions()}adjustForCollisions(){let e=this.scene,t=this.scene.physics.collide(this,e.level.blocks)||e.physics.collide(this,e.level.moveable)||e.physics.collide(this,e.player)||e.physics.collide(this,e.remote),s=this.scene.physics.overlap(this,e.level.blocks)||e.physics.overlap(this,e.level.moveable)||e.physics.overlap(this,e.player)||e.physics.overlap(this,e.remote),i=this.getFacingBlock();if(t||s&&e.level.isBlockPassable(i.x,i.y)){let e=this.findDeltaFromPassing();Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))<=20&&this.adjustToCurrentBlock()}}adjustToCurrentBlock(){this.x=this.block.x*a,this.y=this.block.y*a}getFacingBlock(){let e={x:0,y:0};return"up"==this.direction?(e.x=this.block.x,e.y=this.block.y-1):"down"==this.direction?(e.x=this.block.x,e.y=this.block.y+1):"left"==this.direction?(e.x=this.block.x-1,e.y=this.block.y):"right"==this.direction&&(e.x=this.block.x+1,e.y=this.block.y),e}findDeltaFromPassing(){let e={center:{x:0,y:0}};e.center.x=this.block.x*a+24,e.center.y=this.block.y*a+24;let t={x:0,y:0};return t.x=Math.abs(this.center.x-e.center.x),t.y=Math.abs(this.center.y-e.center.y),t}}class c extends n{constructor(e,t,s,i){super(e,t,s,i),this.setPushable(!1)}update(){super.update()}}class d extends h{constructor(e,t,s,i){super(e,t,s,i),this.setPushable(!1)}update(){super.update(),this.isMoving&&(this.targetCoords.x?(this.x+=2*this.movingDirection,console.log("MOVING"),(this.movingDirection>0&&this.x>=this.targetCoords.x||this.movingDirection<0&&this.x<=this.targetCoords.x)&&(this.x=this.targetCoords.x,this.isMoving=!1,console.log("STOPPED"))):this.targetCoords.y&&(this.y+=2*this.movingDirection,console.log("MOVING"),(this.movingDirection>0&&this.y>=this.targetCoords.y||this.movingDirection<0&&this.y<=this.targetCoords.y)&&(this.y=this.targetCoords.y,this.isMoving=!1,console.log("STOPPED"))))}moveToX(e){this.isMoving||(this.targetCoords={x:e,y:null},this.movingDirection=this.x-this.targetCoords.x>0?-1:1,this.isMoving=!0,console.log(this.targetCoords),console.log({x:this.x,y:this.y}))}moveToY(e){this.isMoving||(this.targetCoords={x:null,y:e},this.movingDirection=this.y-this.targetCoords.y>0?-1:1,this.isMoving=!0,console.log(this.targetCoords),console.log({x:this.x,y:this.y}))}adjustForCollisions(){}}class p extends h{constructor(e,t,s,i){super(e,t,s,i),((e,t,s)=>{e.anims.create({key:"walk-down",frames:e.anims.generateFrameNumbers(t,{start:0,end:2}),frameRate:10,repeat:1}),e.anims.create({key:"walk-left",frames:e.anims.generateFrameNumbers(t,{start:3,end:5}),frameRate:10,repeat:1}),e.anims.create({key:"walk-right",frames:e.anims.generateFrameNumbers(t,{start:6,end:8}),frameRate:10,repeat:1}),e.anims.create({key:"walk-up",frames:e.anims.generateFrameNumbers(t,{start:9,end:11}),frameRate:10,repeat:1}),e.anims.create({key:"idle-down",frames:e.anims.generateFrameNumbers(t,{start:0,end:0}),frameRate:10,repeat:1}),e.anims.create({key:"idle-left",frames:e.anims.generateFrameNumbers(t,{start:3,end:3}),frameRate:10,repeat:1}),e.anims.create({key:"idle-right",frames:e.anims.generateFrameNumbers(t,{start:6,end:6}),frameRate:10,repeat:1}),e.anims.create({key:"idle-up",frames:e.anims.generateFrameNumbers(t,{start:9,end:9}),frameRate:10,repeat:1})})(this,i)}update(){super.update()}}class m extends p{constructor(e,t,s,i,a){super(e,t,s,i),this.scene=e,this.movementCallback=a,this.controls={up:this.scene.input.keyboard.addKey("W"),down:this.scene.input.keyboard.addKey("S"),left:this.scene.input.keyboard.addKey("A"),right:this.scene.input.keyboard.addKey("D")},console.log(this.scene.input.gamepad)}update(){super.update(),this.controls.down.isDown?(this.direction=o,this.setVelocityX(0),this.setVelocityY(500),this.play("walk-down",!0),this.movementCallback(this)):this.controls.up.isDown?(this.direction="up",this.setVelocityX(0),this.setVelocityY(-500),this.play("walk-up",!0),this.movementCallback(this)):this.controls.right.isDown?(this.direction=l,this.setVelocityX(500),this.setVelocityY(0),this.play("walk-right",!0),this.movementCallback(this)):this.controls.left.isDown?(this.direction=r,this.setVelocityX(-500),this.setVelocityY(0),this.play("walk-left",!0),this.movementCallback(this)):(this.setVelocityX(0),this.setVelocityY(0),this.play(`idle-${this.direction}`),this.movementCallback(this))}}class y extends m{constructor(e,t,s,i){super(e,t,s,"playerSprite",i),e.physics.add.collider(this,e.level.moveable,v)}update(){super.update()}}class g extends m{constructor(e,t,s,i){super(e,t,s,"mouseSprite",i)}update(){super.update()}}class u extends p{constructor(e,t,s,i){super(e,t,s,i)}update(){super.update()}}class b extends u{constructor(e,t,s){super(e,t,s,"catSprite")}update(){super.update()}}class k extends u{constructor(e,t,s){super(e,t,s,"monsterSprite"),e.physics.add.collider(this,e.level.moveable,v)}update(){super.update()}}let v=(e,t)=>{let s=e,i=t,n=s.scene;if(!i.isMoving)switch(s.direction){case"up":if(!n.level.isBlockPassable(i.block.x,i.block.y-1))return void console.log("UNPASSABLE");n.level.clearTile(i.block.x,i.block.y),n.level.setTile(i.block.x,i.block.y-1),i.moveToY(i.y-a);break;case o:if(!n.level.isBlockPassable(i.block.x,i.block.y+1))return void console.log("UNPASSABLE");n.level.clearTile(i.block.x,i.block.y),n.level.setTile(i.block.x,i.block.y+1),i.moveToY(i.y+a);break;case r:if(!n.level.isBlockPassable(i.block.x-1,i.block.y))return void console.log("UNPASSABLE");n.level.clearTile(i.block.x,i.block.y),n.level.setTile(i.block.x-1,i.block.y),i.moveToX(i.x-a);break;case l:if(!n.level.isBlockPassable(i.block.x+1,i.block.y))return void console.log("UNPASSABLE");n.level.clearTile(i.block.x,i.block.y),n.level.setTile(i.block.x+1,i.block.y),i.moveToX(i.x+a)}};var x=s(840);class f extends Phaser.Scene{create(){this.isPaused=!1}}class S extends Phaser.GameObjects.GameObject{constructor(e,t){super(e,"level"),this.levelConfig=t,e.add.existing(this),this.blocks=this.scene.physics.add.group(),this.moveable=this.scene.physics.add.group();for(let t=0;t<this.levelConfig.blocksY;t++)for(let s=0;s<this.levelConfig.blocksX;s++)if("*"===this.levelConfig.tilemap[t][s]){let i=new c(e,s*a,t*a,this.levelConfig.blockAsset);i.depth=t*a,this.blocks.add(i)}else if("#"===this.levelConfig.tilemap[t][s]){let i=new d(e,s*a,t*a,this.levelConfig.breakableAsset);i.depth=t*a,this.moveable.add(i),i.setDrag(2e3,2e3),this.scene.physics.add.collider(i,this.blocks)}else if("E"===this.levelConfig.tilemap[t][s]){let i=new c(e,s*a,t*a,this.levelConfig.exitAsset);i.depth=t*a,this.blocks.add(i),this.exit=i}}getTile(e,t){return this.levelConfig.tilemap[t][e]}clearTile(e,t){this.levelConfig.tilemap[t][e]=" "}setTile(e,t){this.levelConfig.tilemap[t][e]="#"}isBlockPassable(e,t){return e>=0&&t>=0&&e<this.levelConfig.blocksX&&t<this.levelConfig.blocksY&&" "===this.getTile(e,t)}isBlockPassableAndNotBreakable(e,t){return e>=0&&t>=0&&e<this.levelConfig.blocksX&&t<this.levelConfig.blocksY&&"*"!==this.getTile(e,t)}isBlockBreakable(e,t){return"#"===this.getTile(e,t)}update(){this.blocks.children.each((e=>{e.update()}),this),this.moveable.children.each((e=>{e.update()}),this)}}const w={level1:{tilemap:[["*","*","*","*","*","*","*","*","*","*","*","*","*","*","*"],["*"," "," "," "," ","*"," ","*"," ","*"," ","*"," "," ","*"],["*"," "," "," "," ","*"," "," "," "," "," "," "," "," ","*"],["*","*"," "," "," ","*"," ","*"," ","*"," ","*"," ","*","*"],["*","*"," "," "," ","*"," "," "," "," "," "," "," "," ","*"],["*","*"," ","*"," ","*"," ","*"," ","*"," ","*"," ","*","*"],["*","*"," "," ","#"," "," "," "," "," "," "," "," "," ","*"],["*","*","*","*","*","*"," ","*","*","*","*","*"," "," ","*"],["*"," "," "," "," "," "," "," ","#"," ","#"," "," "," ","*"],["*","*"," "," "," ","*"," ","*"," "," "," "," "," "," ","*"],["*"," "," "," "," "," "," ","*"," "," ","#"," "," "," ","*"],["*","*"," "," "," "," "," ","*"," "," "," "," "," ","*","*"],["E"," "," "," "," "," "," ","*"," "," "," "," "," ","*","*"],["*","*"," ","*"," ","*"," ","*"," ","*"," ","*"," ","*","*"],["*","*","*","*","*","*","*","*","*","*","*","*","*","*","*"]],blocksX:15,blocksY:15,player1Start:{x:1,y:1},player2Start:{x:13,y:1},blockAsset:"block",breakableAsset:"breakable",exitAsset:"door",nextLevel:"level2"}};let C=new URLSearchParams(window.location.search).get("sessionId")||"",T=new URLSearchParams(window.location.search).get("cycle");class P extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.spritesheet("playerSprite","assets/img/player.png",{frameWidth:a,frameHeight:a}),this.load.spritesheet("catSprite","assets/img/cat.png",{frameWidth:a,frameHeight:a}),this.load.spritesheet("mouseSprite","assets/img/player.png",{frameWidth:a,frameHeight:a}),this.load.spritesheet("monsterSprite","assets/img/cat.png",{frameWidth:a,frameHeight:a}),this.load.image("button","assets/img/button.png"),this.load.image("panel","assets/img/panel.png"),this.load.image("block","assets/img/block.png"),this.load.image("breakable","assets/img/breakable.png"),this.load.image("door","assets/img/door.png")}create(){this.scene.start("CycleScene",{cycle:T})}}class O{constructor(e,t,s){this.elements=new Set,this.panel=e.add.image(t,s,"panel"),this.elements.add(this.panel),this.headerText=e.add.text(t-100,s-145,"What is up, mah dudes",{fontSize:"16px",color:"#000",backgroundColor:"#eeeeee"}),this.elements.add(this.headerText),this.buttonLightScene=e.add.image(t,s-50,"button").setInteractive(),this.elements.add(this.buttonLightScene),this.buttonLightSceneText=e.add.text(this.buttonLightScene.x-30,this.buttonLightScene.y-8,"Light Scene",{fontSize:"10px",color:"#eeeeee"}),this.elements.add(this.buttonLightSceneText),this.buttonDarkScene=e.add.image(t,s+30,"button").setInteractive(),this.elements.add(this.buttonDarkScene),this.buttonDarkSceneText=e.add.text(this.buttonDarkScene.x-30,this.buttonDarkScene.y-8,"Dark Scene",{fontSize:"10px",color:"#eeeeee"}),this.elements.add(this.buttonDarkSceneText),this.buttonStartScene=e.add.image(t,s+110,"button").setInteractive(),this.elements.add(this.buttonStartScene),this.buttonStartSceneText=e.add.text(this.buttonStartScene.x-30,this.buttonStartScene.y-8,"Start Scene",{fontSize:"10px",color:"#eeeeee"}),this.elements.add(this.buttonStartSceneText),this.buttonLightScene.on("pointerdown",(function(){console.log("button1"),e.scene.start("DayCycleScene")})),this.buttonDarkScene.on("pointerdown",(function(){console.log("button2"),e.scene.start("NightCycleScene")})),this.buttonStartScene.on("pointerdown",(function(){console.log("button3"),e.scene.start("StartScene")}))}disableUI(){Array.from(this.elements).forEach((e=>{e.destroy()}))}}class D extends Phaser.Scene{constructor(){super({key:"StartScene"}),this.state="PLAYING"}create(){this.menu=new O(this,600,350)}}const E={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1280,height:720},scene:[P,class extends f{constructor(){super({key:"CycleScene"}),this.state="WAITING",this.levelId="level1"}onPlayerMove(e,t){let{direction:s,x:i,y:a,body:{velocity:{x:o,y:r}}}=e;t.send(JSON.stringify({type:"UPDATE",sessionId:C,player:this.cycle,playerData:{direction:s,x:i,y:a,velocity:{x:o,y:r},currentAnimation:e.anims.currentAnim.key}}))}onRemoteMove({playerData:{x:e,y:t,direction:s,currentAnimation:i,velocity:a}}){this.remote.x=e,this.remote.y=t,this.remote.direction=s,this.remote.body.velocity.x=a.x,this.remote.body.velocity.y=a.y,this.remote.play(i,!0)}init({cycle:e}){this.cycle=e}create(){let e,t;"day"===this.cycle?(this.cameras.main.setBackgroundColor("#FFFFFF"),e=this.add.text(.5*this.game.scale.width,.5*this.game.scale.height,"Waking Up...",{fontSize:"30pt",stroke:"#000",strokeThickness:5}),e.setOrigin(.5,.5)):"night"===this.cycle&&(this.cameras.main.setBackgroundColor("#000000"),e=this.add.text(.5*this.game.scale.width,.5*this.game.scale.height,"Falling Asleep...Sweet Dreams",{fontSize:"30pt",stroke:"#000",strokeThickness:5}),e.setOrigin(.5,.5));try{let s;t=this.ws=new x.w3cwebsocket("wss://deusprogrammer.com/ws/hypnagogia"),this.ws.onopen=()=>{console.log("CONNECTED TO WEBSOCKET"),this.ws.send(JSON.stringify({type:"CONNECT",sessionId:C,player:this.cycle,playerData:{x:0,y:0,direction:"DOWN",currentAnimation:"IDLE",state:"ALIVE"}})),s=setInterval((()=>{this.ws.send(JSON.stringify({type:"PING",sessionId:C,player:this.cycle,playerData:{x:0,y:0,direction:"DOWN",currentAnimation:"IDLE",state:"ALIVE"}}))}),1e4)},this.ws.onmessage=s=>{let i=JSON.parse(s.data);switch(this.game.scale.setGameSize(w[this.levelId].blocksX*a,w[this.levelId].blocksY*a),i.type){case"READY":console.log("OTHER PLAYER READY"),this.state="PLAYING",this.level=new S(this,w[this.levelId]),"day"===this.cycle?(this.player=new y(this,w[this.levelId].player1Start.x*a,w[this.levelId].player1Start.y*a,(e=>{this.onPlayerMove(e,t)})),this.remote=new b(this,w.level1.player2Start.x*a,w.level1.player2Start.y*a),this.physics.add.collider(this.player,this.remote,(()=>{let e=this.add.text(.5*this.game.scale.width,.5*this.game.scale.height,"You got the key...\nbut night\nsnuffs out\nthe light of day.",{fontSize:"30pt",stroke:"#000",strokeThickness:5});e.depth=999,e.setOrigin(.5,.5),setTimeout((()=>{this.state="COMPLETED"}),5e3)})),this.physics.add.collider(this.remote,this.level.exit,(()=>{let e=this.add.text(.5*this.game.scale.width,.5*this.game.scale.height,"You failed...\na night of terror awaits",{fontSize:"30pt",stroke:"#000",strokeThickness:5});e.depth=999,e.setOrigin(.5,.5),setTimeout((()=>{this.state="FAILED"}),5e3)}))):"night"===this.cycle&&(this.player=new g(this,w[this.levelId].player2Start.x*a,w[this.levelId].player2Start.y*a,(e=>{this.onPlayerMove(e,t)})),this.remote=new k(this,w[this.levelId].player1Start.x*a,w[this.levelId].player1Start.y*a),this.physics.add.collider(this.remote,this.player,(()=>{let e=this.add.text(.5*this.game.scale.width,.5*this.game.scale.height,"You were consumed\nby the darkness...\nmorning comes.",{fontSize:"30pt",stroke:"#000",strokeThickness:5});e.depth=999,e.setOrigin(.5,.5),this.cameras.main.zoomTo(1),this.cameras.main.stopFollow(),this.cameras.main.centerOn(.5*this.game.scale.width,.5*this.game.scale.height),setTimeout((()=>{this.state="FAILED"}),5e3)})),this.physics.add.collider(this.player,this.level.exit,(()=>{let e=this.add.text(.5*this.game.scale.width,.5*this.game.scale.height,"You escaped the room, \nbut tomorrow \nbrings more of the same!",{fontSize:"30pt",stroke:"#000",strokeThickness:5});e.depth=999,e.setOrigin(.5,.5),this.cameras.main.zoomTo(1),this.cameras.main.stopFollow(),this.cameras.main.centerOn(.5*this.game.scale.width,.5*this.game.scale.height),setTimeout((()=>{this.state="COMPLETED"}),5e3)})),this.cameras.main.startFollow(this.player),this.cameras.main.zoom=3),e.destroy();break;case"UPDATE":this.onRemoteMove(i)}},this.ws.onclose=()=>{console.log("SOCKET CLOSED"),clearInterval(s),this.scene.start("ErrorScene",{errorMessage:"Socket closed"})},this.ws.onerror=()=>{console.log("ERROR"),clearInterval(s),this.scene.start("ErrorScene",{errorMessage:"Socket failure"})}}catch(e){console.log("CAUGHT ERROR: "+e),this.scene.start("ErrorScene",{errorMessage:e})}}update(){"PLAYING"===this.state?(this.player.update(),this.remote.update(),this.level.update()):"COMPLETE"!==this.state&&"FAIL"!==this.state||("day"===this.cycle?this.scene.start("CycleScene",{cycle:"night"}):this.scene.start("CycleScene",{cycle:"day"}))}},i,D],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:0}}}};window.addEventListener("load",(()=>{new Phaser.Game(E)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,s,a,o)=>{if(!s){var r=1/0;for(c=0;c<e.length;c++){for(var[s,a,o]=e[c],l=!0,n=0;n<s.length;n++)(!1&o||r>=o)&&Object.keys(i.O).every((e=>i.O[e](s[n])))?s.splice(n--,1):(l=!1,o<r&&(r=o));if(l){e.splice(c--,1);var h=a();void 0!==h&&(t=h)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[s,a,o]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,o,[r,l,n]=s,h=0;if(r.some((t=>0!==e[t]))){for(a in l)i.o(l,a)&&(i.m[a]=l[a]);if(n)var c=n(i)}for(t&&t(s);h<r.length;h++)o=r[h],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(c)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(669)));var a=i.O(void 0,[216],(()=>i(204)));a=i.O(a)})();